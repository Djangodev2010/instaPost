{% extends "base.html" %}

{% load static %}

{% block title %} Home Page{% endblock title %}

{% block css %}
    <link rel="stylesheet" href="{% static 'posts/style.css' %}">
{% endblock css %}

{% block content %}

<ul id="posts"></ul>

{% for post in posts %}
  <div class="container mt-4" id="post-{{post.id}}">
    <!-- Sample Post -->
    <div class="card text-dark">
      <div class="card-body">
        <a href="{% url 'post_detail' pk=post.id %}" style="text-decoration: none;"><h5 class="card-title">{{post.title | title}}</h5></a>
        {% if request.user == post.user %}
        <p class="text-muted" style="font-size: 0.9rem;">
          Posted by <strong>You</strong> ‚Ä¢ {{ post.created_on|timesince }} ago
        </p>
        {% else %}
        <p class="text-muted" style="font-size: 0.9rem;">
          Posted by <strong>{{ post.user.username|truncatechars:10 }}</strong> ‚Ä¢ {{ post.created_on|timesince }} ago
        </p>
        {% endif %}
        <p class="card-text">{{post.content | truncatewords:10}}</p>
        <button class="btn btn-sm btn-success like-btn" data-id="{{post.id}}">üëçüèª</button>
        <button class="btn btn-sm btn-danger dislike-btn" data-id="{{post.id}}">üëéüèª</button>
        <button class="btn btn-sm btn-dark">Comment</button>
        <button class="btn btn-sm btn-dark" style="background-color: blue;">Save</button>
      </div>
    </div>
  </div>

{% endfor %}
  
  <!-- Floating + Button -->
  <a href="{% url 'create_post' %}" class="fab-plus-btn">+</a>
  
{% endblock content %}

{% block script %}
<script>
$(".like-btn").on("click", function(e){
    e.preventDefault();
    const postId = $(this).data("id");

    $.ajax({
        method: 'GET',
        url: `like-post/${postId}`,  // ‚Üê Now works!
        success: function(response){
            console.log(response);  // You can update UI here
        },
        error: function(){
            alert("Something went wrong!");
        }
    });
});

$(".dislike-btn").on("click", function(e){
    e.preventDefault();
    const postId = $(this).data("id");

    $.ajax({
        method: 'GET',
        url: `dislike-post/${postId}`,  // ‚Üê Now works!
        success: function(response){
            console.log(response);  // You can update UI here
        },
        error: function(){
            alert("Something went wrong!");
        }
    });
});
</script>
{% endblock script %}